<!DOCTYPE html>
<html>
  <head>
    <title>test</title>
    <script type="text/javascript" src="./jquery-3.3.1.js"></script>
    <script type="text/javascript" src="./hls.min.js"></script>
    <script type="text/javascript" src="./MonitorConnPool.js"></script>
  </head>
  <body>
    <!-- <video id="video-${key}"  style="height:200px;" muted></video> -->
    <video id="video" style="height:500px;" muted></video>
    <script type="text/javascript">
      function createVideo(type,key) {
        if ($("#videosBox" + type).length === 0) {
          let html = `<div id="videosBox${type}"></div>`;
          $("body").append(html);
        }
        // for (const key of keys) {
        $("#videosBox" + type).append(
          `<video id="video-${key}"  style="height:200px;" muted></video>`
        );
        MonitorConnPool.play(key, document.getElementById("video-" + key),type);
        // }
      }
      function searchFormDB(cb, sql) {
        fetch(
          `http://${
            window.location.hostname
          }:8014/sqlservice/v1/executeSql?sql=${sql}`,
          {
            header: {
              "Access-Control-Allow-Origin": "*"
            }
          }
        )
          .then(response => response.json())
          .then(cb);
      }
      function cacheVideos(keys){
        var i = 0;
        setInterval(() => {
          if(i<keys.length){
            createVideo(3,keys[i].guid)
            var key = keys[i].guid;
            console.log(key,'startloaded')
            setTimeout(()=>{
              MonitorConnPool.stopLoadVideo(key, 'cache')
              console.log(key,'stoploaded');
              document.getElementById("video-" + key).remove();
            },10000)
            i++;
          }else{
            i = 0;
          }
        }, 2000);
      }
      const apeSQL = `select guid from ape;`
      searchFormDB(cacheVideos,apeSQL);
    </script>
  </body>
</html>
